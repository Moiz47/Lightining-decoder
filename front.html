<html>
    <head>
        <title>Lightining Payment Decoder</title>
        <link href="https://fonts.googleapis.com/css?family=Anton&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
           

        <style type = "text/css">
            body{
                background-image: linear-gradient(to bottom right, black, #FB4444 );
            }

            .jumbotronCss{
                margin-top: 30px;
                background-color: #D5FEF8;
            }

            .para{
                text-align: center;
            }

            .bottomPara{
               margin: 0px;
               color: white;
            }

            #OutputDiv{
                display:none;
            }

            #alertDiv{
                display:none;
            }

            td{
                padding:10px 10px 5px 2px !important;
                word-wrap: break-word;
            }

            .width{
                color:rgba(0, 119, 255, 0.952);
                
            }

            th{
                font-weight: Bold;
                font-family:Arial, Helvetica, sans-serif;
                font-size:x-large;          
             }

            .firstColumn{
                font-weight: bold;
                color:rgba(0, 119, 255, 0.952);

            }

            table{
                table-layout: fixed ;
            }

            .forcedMargin{
                margin-right: 400px !important;
            }
        
            .inside_tag{
               
                color: green;
                word-wrap: break-word;
            }

            @media screen and (max-width: 500px) {
                .inside_tag{
                    width: 200px;
                }
            }

            p{
                margin:0px;
                word-wrap: 'break-word';
            }

            h3,h4{
                font-style: italic;
            }

            .textBoxStyling{
                width: 100%;
                display: flex;
                align-items: center;
            }

            .text{
                width: 70%;
                padding: 0px 20px;
            }

            button{
                font-size: 20px;  
                background-color: 161515;
                padding: 50px 90px;
                text-align: center;
                font-weight: normal;
                box-sizing:border-box;
                border-radius: 5px;
                color: White;
                
            }

        </style>
    </head>



    <body>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

            <div class= "container">
                    <div class="jumbotron jumbotronCss">
                        
                        <div class = "para">
                            <h1><em>Lightining Payment Decoder</em></h1>
                            <p>Decoder for lightning network payment requests as per <span>
                                <a href="https://github.com/lightningnetwork/lightning-rfc/blob/master/11-payment-encoding.md">BOLT #11.</a>
                            </span></p>
                        </div>    
                        <div class = "textBoxStyling">
                            <form class = "text">
                                <div class= "form-group">
                                    <label for = "textarea">Enter Your Request String:</label>
                                    <textarea name = "mytext" class = "form-control" id = "textarea" rows="5" placeholder="Enter request string"></textarea> 
                                </div>      
                            </form>
                            <button id = "but">Decode</button>
                        </div>           

                        <div id = "alertDiv" class = "alert alert-danger alert-dismissible fade show" role = "alert">  
                           
                        </div>

                        <div id = "OutputDiv" class = "alert alert-warning">
                            <div><h3>Currency Information</h3></div>
                            <table class = " table table-striped" >            
                                <tbody class = "inside">
                                    <tr>
                                        
                                    </tr>
                                </tbody>
                            </table>

                            <div>
                                <h4>Tags</h4>
                                <div class = "tags inside_tag">
                                    
                                </div>
                            </div>        
                        </div>

                        <div id = "rawData">
                            
                        </div>

                    </div>

                    <div class = "para">
                        <a href = "https://github.com/Moiz47/Lightining-decoder">https://github.com/Moiz47/Lightining-decoder</a>
                        <p class = "bottomPara">Developed and powered by 
                            <a href ="https://Ciphertrick.com"> Ciphertrick.com</a></p>
                    </div>
            </div>

    <script type = "text/javascript">
    let text = null;
    let Received_data;
    let coinTypeTestnet = "false";
    const strTestnet = "https://1ml.com/testnet/node/";
    const str = "https://1ml.com/node/";
    let onemlLink = null;




        $("#but").click(function(){
            let errorMsg = "";
            text = $("#textarea").val();

           $.post("/", {t: text}, function(data){
            if(data){
                $("#OutputDiv").css("display", "block");
                $('#alertDiv').css("display", "none");
                $('#rawData').css("display", "block");
                
               
                if((Received_data === undefined) || (data.decode.paymentRequest !== Received_data.decode.paymentRequest)){
                
                    Received_data = {...data};
                    $(".tags, .inside").empty();
                    $("#rawData").empty();

                    if(Received_data.decode.coinType == "testnet"){
                        coinTypeTestnet = true;
                        
                    }
                    console.log(coinTypeTestnet);

                    const tag_array = Received_data.decode.tags;
                    for(let i=0; i<tag_array.length; i++){   
                        var temp = tag_array[i]
                        $(".tags").append("<div><p>TagName: "+temp.tagName+"</p><p>Data: "+temp.data+"</p><hr></div>")
                    }
                    
                    for(let properties in Received_data.decode){
                         
                        if(Received_data.decode.tags != Received_data.decode[properties]){
                            console.log("hello");
                            if(properties == "payeeNodeKey"){
                            
                                if(coinTypeTestnet){
                                    onemlLink = strTestnet.concat(Received_data.decode[properties] )
                                    $(".inside").append("<tr><td class = 'firstColumn'>"+properties+"</td> <td class = 'width'>"+ "<a style = 'color: purple' target='_blank' href = '"+onemlLink+"' >" + Received_data.decode[properties]+"</a></td></tr>");
                                    
                                }else{
                                    onemlLink = str.concat(Received_data.decode[properties] )
                                    $(".inside").append("<tr><td class = 'firstColumn'>"+properties+"</td> <td class = 'width'>"+ "<a target='_blank' style = 'color: purple' href = '"+onemlLink+"' >" + Received_data.decode[properties]+"</a></td></tr>");
                                
                                }

                            }else{
                                $(".inside").append("<tr><td class = 'firstColumn'>"+properties+"</td> <td class = 'width'>"+Received_data.decode[properties]+"</td></tr>");
                            }
                        }
                    }
                    
                    $('#rawData').html("<h3>JSON data</h3><pre>"+ JSON.stringify(data, null, 2) + "</pre>");
                }
            }

        
            }).fail(function(){
                $('#OutputDiv').css("display", "none");
                $('#alertDiv').css("display", "block");
                $('#rawData').css("display", "none");

                if($('#textarea').val() == ""){
                    errorMsg = "Cannot leave this field empty";
                    $('#alertDiv').html(errorMsg);
                } else{
                    errorMsg = "String entered is incorrect";
                    $('#alertDiv').html(errorMsg);
                }
            });
        });
    </script>
    </body>
</html>
