<html>
    <head>
        <title>Lightining Invoice Decoder</title>
        <meta name="description" content="A tool for decoding lightning network payment invoice as defined in BOLT #11.">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel='shortcut icon' type='image/x-icon' href='favicon.ico'/>
        <link href="https://fonts.googleapis.com/css?family=Anton&display=swap" rel="stylesheet">
        <link rel="shortcut icon" href="https://ciphertrick.com/wp-content/uploads/2017/05/xLogo_1494089410235-short-cropped-150x150.png.pagespeed.ic.hSnjOtGVIy.webp">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://kit.fontawesome.com/0f7fec5cc5.js" crossorigin="anonymous"></script>
           

        <style type = "text/css">
            body{
                background-image: linear-gradient(to bottom right, black, #FB4444 );
            }

            .jumbotronCss{
                margin-top: 30px;
                background-color: #D5FEF8;
            }

            .para{
                text-align: center;
            }

            .bottomPara{
               margin: 0px;
               color: white;
            }

            #OutputDiv{
                display:none;
            }

            #alertDiv{
                display:none;
            }

            td{
                padding:10px 10px 5px 2px !important;
                word-wrap: break-word;
            }

            .width{
                color:rgba(0, 119, 255, 0.952);
                
            }

            th{
                font-weight: Bold;
                font-family:Arial, Helvetica, sans-serif;
                font-size:x-large;          
             }

            .firstColumn{
                font-weight: bold;
                color:rgba(0, 119, 255, 0.952);

            }

            table{
                table-layout: fixed ;
            }

            .forcedMargin{
                margin-right: 400px !important;
            }
        
            .inside_tag{
               
                color: green;
                word-wrap: break-word;
            }

            @media screen and (max-width: 500px) {
                .inside_tag{
                    width: 200px;
                }
            }

            pre {
                background-color: #eeeeee;
                padding: 10px
            }

            p{
                margin:0px;
                word-wrap: 'break-word';
            }

            h3,h4{
                font-style: italic;
            }

            .textBoxStyling{
                width: 100%;
                display: flex;
                align-items: center;
            }

            .text{
                width: 100%;
                padding: 0px 0px;
            }

            .bigButton {
                font-size: 58px;
                padding: 36px 90px;    
                
            }

            #responsiveButton{
                display:none
            }

            .center{
                display: flex;
                flex-direction: row;
                align-items: center;
               }
            
            .col-sm{
                padding-top: 10px;
            }

            .coll{
                width: 75%;
                padding-left: 12px;
            }

            @media (max-width: 1200px){
                .coll{
                    width: 65% ;
                    
                }
            }
            @media (max-width: 995px){
                .coll{
                    width: 55%;
                    
                    
                }
            }

            @media (max-width: 767px){
                .coll{
                    width: 100%;
                    padding-right: 15px
                }

                .bigButton {
                    display:none
                    }

                #responsiveButton{
                    display:block
                }
                
                
            }

           


           


        </style>
    </head>



    <body>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <a class="navbar-brand" href="#">Lightning Decoder</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>
              
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                      <a class="nav-link" href="https://ciphertrick.com">Home</a>
                    </li>
                    <li class="nav-item active">
                      <a class="nav-link" href="https://ciphertrick.com/the-lightning-network-how-to-install-send-and-receive-bitcoin-money/">Setup Your Own Lightning Node</a>
                    </li>
                </div>
              </nav>
            
            <div class= "container">
                    <div class="jumbotron jumbotronCss">
                        
                        <div class = "para">
                            <h1><em style="color: #007bff">Lightining Payment Invoice Decoder</em></h1>
                            <p>A tool for decoding lightning network payment invoice as defined in <span>
                                <a href="https://github.com/lightningnetwork/lightning-rfc/blob/master/11-payment-encoding.md">BOLT #11.</a>
                            </span></p>
                        </div> 

                            <div class = "row center">
                                <div class = "coll">
                                    <form class = "text">
                                        <div class= "form-group">
                                            <label for = "textarea">Enter Your Invoice:</label>
                                            <textarea name = "mytext" class = "form-control" id = "textarea" rows="5" placeholder="Enter request string"></textarea> 
                                        </div>      
                                    </form>
                                    <button type="button" id = "responsiveButton" class="btn btn-primary btn-block but">Decode</button>
                                </div>
                                <div class = "col-sm">
                                    <button class="btn btn-primary bigButton but"><i class="fas fa-bolt"></i></button>
                                </div>   
                            </div> 
                            

                            <div id = "alertDiv" class = "alert alert-danger alert-dismissible fade show" role = "alert">  
                           
                            </div>

                        <div id = "OutputDiv" class = "alert alert-warning">
                            <div><h3>Invoice Information</h3></div>
                            <table class = "table" >            
                                <tbody class = "inside">
                                    <tr>
                                        
                                    </tr>
                                </tbody>
                            </table>

                            <div>
                                <h4>Tags</h4>
                                <div class = "tags inside_tag">
                                    
                                </div>
                            </div>        
                        </div>

                        <div id = "rawData">
                            
                        </div>

                    </div>

                    <div class = "para">
                        
                        <img src = "resize.jpg" alt ="qrCode" width="150" height="150">
                        <p>lndecode.ciphertrick.com</p>
                        <a href = "https://github.com/Moiz47/Lightining-decoder">https://github.com/Moiz47/Lightining-decoder</a>
                        <p class = "bottomPara">Developed and powered by 
                            <a href ="https://Ciphertrick.com"> Ciphertrick.com</a></p>
                    </div>
                    <br></br>
                    
            </div>

    <script type = "text/javascript">
    let text = null;
    let Received_data;
    let coinTypeTestnet = false;
    const strTestnet = "https://1ml.com/testnet/node/";
    const str = "https://1ml.com/node/";
    let onemlLink = null;


    function copyClipboard(id) {
        console.log(id);
        var elm = document.getElementById(id);
        // for Internet Explorer

        if(document.body.createTextRange) {
            var range = document.body.createTextRange();
            range.moveToElementText(elm);
            range.select();
            document.execCommand("Copy");
            alert("Copied!");
        }
        else if(window.getSelection) {
            // other browsers

            var selection = window.getSelection();
            var range = document.createRange();
            range.selectNodeContents(elm);
            selection.removeAllRanges();
            selection.addRange(range);
            document.execCommand("Copy");
            alert("Copied div content to clipboard");
        }
    }




        $(".but").click(function(){
            let errorMsg = "";
            text = $("#textarea").val();

           $.post("/", {t: text}, function(data){
            if(data){
                $("#OutputDiv").css("display", "block");
                $('#alertDiv').css("display", "none");
                $('#rawData').css("display", "block");
                
               
                if((Received_data === undefined) || (data.decode.paymentRequest !== Received_data.decode.paymentRequest)){
                
                    Received_data = {...data};
                    $(".tags, .inside").empty();
                    $("#rawData").empty();

                    if(Received_data.decode.coinType == "testnet"){
                        coinTypeTestnet = true;
                        
                    }
                   // console.log(coinTypeTestnet);

                    const tag_array = Received_data.decode.tags;
                    for(let i=0; i<tag_array.length; i++){   
                        var temp = tag_array[i]
                        $(".tags").append("<div><p>TagName: "+temp.tagName+"</p><p>Data: "+temp.data+"</p><hr></div>")
                    }
                    
                    for(let properties in Received_data.decode){
                         
                        if(Received_data.decode.tags != Received_data.decode[properties]){
                            //console.log("hello");
                            if(properties == "payeeNodeKey"){
                            
                                if(coinTypeTestnet){
                                    onemlLink = strTestnet.concat(Received_data.decode[properties] )
                                    $(".inside").append(`<tr>
                                                            <td class = 'firstColumn'>${properties}</td> 
                                                            <td class = 'width'>
                                                                <a id='nodekey' style = 'color: purple' target='_blank' href = '${onemlLink}' >${Received_data.decode[properties]}</a>
                                                                <i style='cursor:pointer' onClick='copyClipboard("nodekey")' class='far fa-copy'></i>
                                                            </td>
                                                        </tr>`);
                                    
                                }else{
                                    onemlLink = str.concat(Received_data.decode[properties] )
                                    $(".inside").append(`<tr>
                                                            <td class = 'firstColumn'>${properties}</td> 
                                                            <td class = 'width'>
                                                                <a id='nodekey' target='_blank' style = 'color: purple' href = '${onemlLink}' > ${Received_data.decode[properties]}</a>
                                                                <i style='cursor:pointer' onClick='copyClipboard("nodekey")' class='far fa-copy'></i>
                                                            </td>
                                                            </tr>`);
                                
                                }

                            }else{
                                $(".inside").append("<tr><td class = 'firstColumn'>"+properties+"</td> <td class = 'width'>"+Received_data.decode[properties]+"</td></tr>");
                            }
                        }
                    }
                    
                    $('#rawData').html(`<h3>JSON data <i style='cursor:pointer' onClick='copyClipboard("json")' class='far fa-copy'></i></h3>
                                            <pre id='json'>${JSON.stringify(data, null, 2)}</pre>`);
                }
            }

        
            }).fail(function(){
                $('#OutputDiv').css("display", "none");
                $('#alertDiv').css("display", "block");
                $('#rawData').css("display", "none");

                if($('#textarea').val() == ""){
                    errorMsg = "Cannot leave this field empty";
                    $('#alertDiv').html(errorMsg);
                } else{
                    errorMsg = "String entered is incorrect";
                    $('#alertDiv').html(errorMsg);
                }
            });
        });
    </script>
    </body>
</html>
